{
    "variables": {
        "aws_region": "{{env `AWS_REGION`}}",
        "role" : "win_int_web"
    },
    "builders": [{
        "type": "amazon-ebs",
        "user_data_file": "./scripts/setup_winrm.ps1",
        "region": "{{user `aws_region`}}",
        "instance_type": "t2.micro",
        "winrm_username": "Administrator",
        "ami_name": "onecms_{{ user `role` }}_{{isotime \"2006_01_02_03_04_05\"}}",
        "associate_public_ip_address" : true,
        "communicator":"winrm",
        "winrm_use_ssl": true,
        "winrm_insecure": true,
        "source_ami" : "ami-f3dcbc8b"
    }],
    "provisioners": [
    {
        "type": "chef-solo",
        "cookbook_paths": ["cookbooks"],
        "guest_os_type": "windows",
        "run_list": [
                "onecms::{{ user `role` }}_configure"
        ]
    },
    {
        "type" : "powershell",
        "inline" : [
                "Install-PackageProvider -Name Nuget -ForceBootstrap",
                "Install-Module pswindowsupdate -force"
        ],
        "elevated_user": "Administrator",
        "elevated_password": "{{.WinRMPassword}}"
    }
    ]
}